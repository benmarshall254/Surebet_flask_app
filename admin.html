from flask import Flask, render_template_string, jsonify, request, session
from datetime import datetime, timedelta
import json
import os
from collections import defaultdict

app = Flask(__name__)
app.secret_key = 'your-secret-key-change-this-in-production'

# In-memory storage for visitor tracking (use database in production)
VISITOR_DATA = {
    'total_visits': 0,
    'unique_visitors': set(),
    'visit_log': [],
    'daily_stats': defaultdict(int),
    'page_views': defaultdict(int)
}

def track_visitor(page_name):
    """Track visitor information"""
    visitor_ip = request.environ.get('HTTP_X_FORWARDED_FOR', request.environ.get('REMOTE_ADDR', 'Unknown'))
    user_agent = request.headers.get('User-Agent', 'Unknown')
    timestamp = datetime.now()
    
    # Track total visits
    VISITOR_DATA['total_visits'] += 1
    
    # Track unique visitors by IP
    VISITOR_DATA['unique_visitors'].add(visitor_ip)
    
    # Track page views
    VISITOR_DATA['page_views'][page_name] += 1
    
    # Track daily stats
    date_key = timestamp.strftime('%Y-%m-%d')
    VISITOR_DATA['daily_stats'][date_key] += 1
    
    # Log visit details
    visit_info = {
        'ip': visitor_ip,
        'user_agent': user_agent,
        'timestamp': timestamp.strftime('%Y-%m-%d %H:%M:%S'),
        'page': page_name
    }
    VISITOR_DATA['visit_log'].append(visit_info)
    
    # Keep only last 100 visits to prevent memory issues
    if len(VISITOR_DATA['visit_log']) > 100:
        VISITOR_DATA['visit_log'] = VISITOR_DATA['visit_log'][-100:]

app = Flask(__name__)
app.secret_key = 'your-secret-key-change-this-in-production'

# In-memory storage for predictions (use database in production)
PREDICTIONS_DATA = [
    {
        "id": 1,
        "match": "Manchester United vs Chelsea",
        "league": "Premier League",
        "date": "2025-06-10",
        "time": "15:00",
        "prediction": "Over 2.5 Goals",
        "odds": "1.85",
        "confidence": "High",
        "status": "active",
        "created_at": "2025-06-09 10:30:00"
    },
    {
        "id": 2,
        "match": "Barcelona vs Real Madrid",
        "league": "La Liga",
        "date": "2025-06-11",
        "time": "20:00",
        "prediction": "Both Teams to Score",
        "odds": "1.72",
        "confidence": "Medium",
        "status": "active",
        "created_at": "2025-06-09 11:15:00"
    },
    {
        "id": 3,
        "match": "Bayern Munich vs Dortmund",
        "league": "Bundesliga",
        "date": "2025-06-12",
        "time": "18:30",
        "prediction": "Home Win",
        "odds": "2.10",
        "confidence": "High",
        "status": "active",
        "created_at": "2025-06-09 12:00:00"
    }
]

# Counter for generating new prediction IDs
PREDICTION_ID_COUNTER = 4

NAVIGATION_TEMPLATE = """
<nav class="navbar">
    <div class="nav-container">
        <div class="nav-logo">
            <h2>🎯 SureBet Pro</h2>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/" class="nav-link">Home</a>
            </li>
            <li class="nav-item">
                <a href="/predictions" class="nav-link">Predictions</a>
            </li>
            <li class="nav-item">
                <a href="/statistics" class="nav-link">Statistics</a>
            </li>
            <li class="nav-item">
                <a href="/about" class="nav-link">About</a>
            </li>
            <li class="nav-item">
                <a href="/admin" class="nav-link admin-link">Admin</a>
            </li>
            <li class="nav-item">
                <a href="/admin/matches" class="nav-link admin-link">Manage Matches</a>
            </li>
        </ul>
    </div>
</nav>
"""

BASE_STYLES = """
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
        line-height: 1.6;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Navigation Styles */
    .navbar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .nav-logo h2 {
        color: #667eea;
        font-weight: 700;
    }

    .nav-menu {
        display: flex;
        list-style: none;
        gap: 2rem;
    }

    .nav-link {
        text-decoration: none;
        color: #333;
        font-weight: 500;
        transition: color 0.3s ease;
    }

    .nav-link:hover {
        color: #667eea;
    }

    .admin-link {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white !important;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        transition: all 0.3s ease;
    }

    .admin-link:hover {
        color: white !important;
        transform: scale(1.05);
    }

    /* Main Content Styles */
    .main-content {
        padding: 2rem 0;
    }

    .hero-section {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 3rem;
        text-align: center;
        margin: 2rem 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .hero-title {
        font-size: 3rem;
        color: white;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .hero-subtitle {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2rem;
    }

    .cta-button {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 1rem 2rem;
        border: none;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .cta-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    /* Card Styles */
    .card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 2rem;
        margin: 1rem 0;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
    }

    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin: 2rem 0;
    }

    .prediction-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-left: 4px solid #667eea;
        padding: 1.5rem;
        border-radius: 10px;
        margin: 1rem 0;
    }

    .match-info {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .league-info {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }

    .prediction-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .prediction-type {
        background: #667eea;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .odds-info {
        font-size: 1.2rem;
        font-weight: 700;
        color: #28a745;
    }

    .confidence-badge {
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .confidence-high {
        background: #d4edda;
        color: #155724;
    }

    .confidence-medium {
        background: #fff3cd;
        color: #856404;
    }

    .confidence-low {
        background: #f8d7da;
        color: #721c24;
    }

    /* Statistics Styles */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: #667eea;
        display: block;
    }

    .stat-label {
        color: #666;
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }

    /* Footer Styles */
    .footer {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        text-align: center;
        padding: 2rem 0;
        margin-top: 3rem;
    }

    /* Ad Styles */
    .ad-container {
        margin: 2rem 0;
        text-align: center;
    }

    .ad-label {
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 0.5rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .nav-menu {
            gap: 1rem;
        }

        .hero-title {
            font-size: 2rem;
        }

        .hero-section {
            padding: 2rem;
        }

        .card-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
"""

@app.route("/")
def home():
    # Track homepage visit
    track_visitor('Home')
    
    return render_template_string(f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SureBet Pro - Professional Betting Predictions</title>
        <meta name="description" content="Get professional surebet predictions with high accuracy rates. Daily football betting tips and analysis.">
        
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6332657251575161"
            crossorigin="anonymous"></script>
        
        {BASE_STYLES}
    </head>
    <body>
        {NAVIGATION_TEMPLATE}
        
        <div class="container">
            <div class="main-content">
                <div class="hero-section">
                    <h1 class="hero-title">🎯 SureBet Pro</h1>
                    <p class="hero-subtitle">Professional betting predictions with proven accuracy</p>
                    <a href="/predictions" class="cta-button">View Today's Predictions</a>
                </div>

                <!-- Top Banner Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>

                <div class="card-grid">
                    <div class="card">
                        <h3>🏆 High Accuracy</h3>
                        <p>Our predictions are based on advanced statistical analysis and expert knowledge, delivering consistent results.</p>
                    </div>
                    
                    <div class="card">
                        <h3>📊 Daily Updates</h3>
                        <p>Fresh predictions every day covering major leagues and tournaments worldwide.</p>
                    </div>
                    
                    <div class="card">
                        <h3>💡 Expert Analysis</h3>
                        <p>Detailed match analysis with confidence ratings to help you make informed decisions.</p>
                    </div>
                </div>

                <!-- Mid-content Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="container">
                <p>&copy; 2025 SureBet Pro. All rights reserved. | Bet responsibly.</p>
            </div>
        </div>

        <script>
            (adsbygoogle = window.adsbygoogle || []).push({{}});
            (adsbygoogle = window.adsbygoogle || []).push({{}});
        </script>
    </body>
    </html>
    """)

@app.route("/admin/matches")
def admin_matches():
    # Track admin matches page visit
    track_visitor('Admin-Matches')
    
    # Get success/error messages from URL parameters
    message = request.args.get('message', '')
    error = request.args.get('error', '')
    
    return render_template_string(f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Manage Matches - SureBet Pro</title>
        
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6332657251575161"
            crossorigin="anonymous"></script>
        
        {BASE_STYLES}
    </head>
    <body>
        {NAVIGATION_TEMPLATE}
        
        <div class="container">
            <div class="main-content">
                <div class="hero-section">
                    <h1 class="hero-title">⚽ Manage Matches</h1>
                    <p class="hero-subtitle">Add, Edit & Update Betting Predictions</p>
                </div>

                {f'<div class="alert alert-success">{message}</div>' if message else ''}
                {f'<div class="alert alert-error">{error}</div>' if error else ''}

                <!-- Add New Match Form -->
                <div class="match-form">
                    <h3>➕ Add New Match Prediction</h3>
                    <form method="POST" action="/admin/matches/add">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Match Teams</label>
                                <input type="text" name="match" class="form-input" placeholder="e.g., Liverpool vs Arsenal" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">League</label>
                                <select name="league" class="form-select" required>
                                    <option value="">Select League</option>
                                    <option value="Premier League">Premier League</option>
                                    <option value="La Liga">La Liga</option>
                                    <option value="Bundesliga">Bundesliga</option>
                                    <option value="Serie A">Serie A</option>
                                    <option value="Ligue 1">Ligue 1</option>
                                    <option value="Champions League">Champions League</option>
                                    <option value="Europa League">Europa League</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Match Date</label>
                                <input type="date" name="date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Match Time</label>
                                <input type="time" name="time" class="form-input" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Prediction</label>
                                <select name="prediction" class="form-select" required>
                                    <option value="">Select Prediction</option>
                                    <option value="Home Win">Home Win</option>
                                    <option value="Away Win">Away Win</option>
                                    <option value="Draw">Draw</option>
                                    <option value="Over 2.5 Goals">Over 2.5 Goals</option>
                                    <option value="Under 2.5 Goals">Under 2.5 Goals</option>
                                    <option value="Both Teams to Score">Both Teams to Score</option>
                                    <option value="Clean Sheet">Clean Sheet</option>
                                    <option value="Over 1.5 Goals">Over 1.5 Goals</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Odds</label>
                                <input type="number" name="odds" class="form-input" step="0.01" min="1.01" placeholder="e.g., 1.85" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Confidence Level</label>
                            <select name="confidence" class="form-select" required>
                                <option value="">Select Confidence</option>
                                <option value="High">High Confidence</option>
                                <option value="Medium">Medium Confidence</option>
                                <option value="Low">Low Confidence</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="submit-btn">🎯 Add Match Prediction</button>
                    </form>
                </div>

                <!-- Current Matches Table -->
                <div class="match-table">
                    <h3>📋 Current Match Predictions</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Match</th>
                                <th>League</th>
                                <th>Date & Time</th>
                                <th>Prediction</th>
                                <th>Odds</th>
                                <th>Confidence</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {''.join([f'''
                            <tr>
                                <td>{pred["id"]}</td>
                                <td>{pred["match"]}</td>
                                <td>{pred["league"]}</td>
                                <td>{pred["date"]} {pred["time"]}</td>
                                <td>{pred["prediction"]}</td>
                                <td>{pred["odds"]}</td>
                                <td>{pred["confidence"]}</td>
                                <td><span class="status-{pred["status"]}">{pred["status"].title()}</span></td>
                                <td>
                                    <form method="POST" action="/admin/matches/toggle/{pred["id"]}" style="display: inline;">
                                        <button type="submit" class="action-btn edit-btn">
                                            {'🔄 Activate' if pred["status"] == "inactive" else '⏸️ Pause'}
                                        </button>
                                    </form>
                                    <form method="POST" action="/admin/matches/delete/{pred["id"]}" style="display: inline;" 
                                          onsubmit="return confirm('Are you sure you want to delete this match?')">
                                        <button type="submit" class="action-btn delete-btn">🗑️ Delete</button>
                                    </form>
                                </td>
                            </tr>
                            ''' for pred in PREDICTIONS_DATA])}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="container">
                <p>&copy; 2025 SureBet Pro. All rights reserved. | Match Management</p>
            </div>
        </div>
    </body>
    </html>
    """)

@app.route("/admin/matches/add", methods=["POST"])
def add_match():
    global PREDICTION_ID_COUNTER
    
    try:
        # Get form data
        new_match = {
            "id": PREDICTION_ID_COUNTER,
            "match": request.form.get("match"),
            "league": request.form.get("league"),
            "date": request.form.get("date"),
            "time": request.form.get("time"),
            "prediction": request.form.get("prediction"),
            "odds": request.form.get("odds"),
            "confidence": request.form.get("confidence"),
            "status": "active",
            "created_at": datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        }
        
        # Add to predictions list
        PREDICTIONS_DATA.append(new_match)
        PREDICTION_ID_COUNTER += 1
        
        return f"""
        <script>
            window.location.href = '/admin/matches?message=Match prediction added successfully!';
        </script>
        """
        
    except Exception as e:
        return f"""
        <script>
            window.location.href = '/admin/matches?error=Error adding match: {str(e)}';
        </script>
        """

@app.route("/admin/matches/toggle/<int:match_id>", methods=["POST"])
def toggle_match_status(match_id):
    try:
        # Find and toggle match status
        for match in PREDICTIONS_DATA:
            if match["id"] == match_id:
                match["status"] = "inactive" if match["status"] == "active" else "active"
                status_text = "activated" if match["status"] == "active" else "paused"
                return f"""
                <script>
                    window.location.href = '/admin/matches?message=Match {status_text} successfully!';
                </script>
                """
        
        return f"""
        <script>
            window.location.href = '/admin/matches?error=Match not found!';
        </script>
        """
        
    except Exception as e:
        return f"""
        <script>
            window.location.href = '/admin/matches?error=Error updating match: {str(e)}';
        </script>
        """

@app.route("/admin/matches/delete/<int:match_id>", methods=["POST"])
def delete_match(match_id):
    try:
        # Find and remove match
        global PREDICTIONS_DATA
        PREDICTIONS_DATA = [match for match in PREDICTIONS_DATA if match["id"] != match_id]
        
        return f"""
        <script>
            window.location.href = '/admin/matches?message=Match deleted successfully!';
        </script>
        """
        
    except Exception as e:
        return f"""
        <script>
            window.location.href = '/admin/matches?error=Error deleting match: {str(e)}';
        </script>
        """

@app.route("/admin")
def admin():
    # Track admin page visit
    track_visitor('Admin')
    
    # Get recent visits (last 10)
    recent_visits = VISITOR_DATA['visit_log'][-10:][::-1]  # Reverse to show newest first
    
    # Get today's stats
    today = datetime.now().strftime('%Y-%m-%d')
    today_visits = VISITOR_DATA['daily_stats'][today]
    
    return render_template_string(f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin Dashboard - SureBet Pro</title>
        
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6332657251575161"
            crossorigin="anonymous"></script>
        
        {BASE_STYLES}
    </head>
    <body>
        {NAVIGATION_TEMPLATE}
        
        <div class="container">
            <div class="main-content">
                <div class="hero-section">
                    <h1 class="hero-title">🔧 Admin Dashboard</h1>
                    <p class="hero-subtitle">Website Analytics & Visitor Tracking</p>
                    <button class="refresh-btn" onclick="location.reload()">🔄 Refresh Data</button>
                </div>

                <div class="admin-dashboard">
                    <div class="admin-card">
                        <div class="admin-stat">
                            <span class="admin-stat-number">{VISITOR_DATA['total_visits']}</span>
                            <div class="admin-stat-label">Total Page Views</div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-stat">
                            <span class="admin-stat-number">{len(VISITOR_DATA['unique_visitors'])}</span>
                            <div class="admin-stat-label">Unique Visitors</div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-stat">
                            <span class="admin-stat-number">{today_visits}</span>
                            <div class="admin-stat-label">Today's Visits</div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-stat">
                            <span class="admin-stat-number">{VISITOR_DATA['page_views']['Home']}</span>
                            <div class="admin-stat-label">Homepage Views</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>📊 Page Views Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        {''.join([f'''
                        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #667eea;">{count}</div>
                            <div style="font-size: 0.9rem; color: #666;">{page}</div>
                        </div>
                        ''' for page, count in VISITOR_DATA['page_views'].items()])}
                    </div>
                </div>

                <div class="card">
                    <h3>📋 Recent Visitor Log</h3>
                    <div class="visitor-log">
                        {''.join([f'''
                        <div class="log-entry">
                            <span class="log-time">{visit['timestamp']}</span> - 
                            <span class="log-ip">{visit['ip']}</span>
                            <span class="log-page">{visit['page']}</span>
                            <br><small style="color: #999;">{visit['user_agent'][:80]}...</small>
                        </div>
                        ''' for visit in recent_visits]) if recent_visits else '<div class="log-entry">No visits recorded yet.</div>'}
                    </div>
                </div>

                <div class="card">
                    <h3>📈 Daily Statistics (Last 7 Days)</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        {''.join([f'''
                        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 1.2rem; font-weight: 600; color: #667eea;">{count}</div>
                            <div style="font-size: 0.8rem; color: #666;">{date}</div>
                        </div>
                        ''' for date, count in sorted(VISITOR_DATA['daily_stats'].items())[-7:]])}
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="container">
                <p>&copy; 2025 SureBet Pro. All rights reserved. | Admin Dashboard</p>
            </div>
        </div>

        <script>
            // Auto-refresh every 30 seconds
            setTimeout(function(){{
                location.reload();
            }}, 30000);
        </script>
    </body>
    </html>
    """)

@app.route("/predictions")
def predictions():
    # Track predictions page visit
    track_visitor('Predictions')
    
    return render_template_string(f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Today's Predictions - SureBet Pro</title>
        
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6332657251575161"
            crossorigin="anonymous"></script>
        
        {BASE_STYLES}
    </head>
    <body>
        {NAVIGATION_TEMPLATE}
        
        <div class="container">
            <div class="main-content">
                <div class="hero-section">
                    <h1 class="hero-title">📈 Today's Predictions</h1>
                    <p class="hero-subtitle">Updated: {datetime.now().strftime('%B %d, %Y at %H:%M')}</p>
                </div>

                <!-- Top Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>

                <div class="predictions-container">
                    {''.join([f'''
                    <div class="prediction-card">
                        <div class="match-info">{pred["match"]}</div>
                        <div class="league-info">{pred["league"]} • {pred["date"]} at {pred["time"]}</div>
                        <div class="prediction-details">
                            <div class="prediction-type">{pred["prediction"]}</div>
                            <div class="odds-info">Odds: {pred["odds"]}</div>
                            <div class="confidence-badge confidence-{pred["confidence"].lower()}">{pred["confidence"]} Confidence</div>
                        </div>
                    </div>
                    ''' for pred in PREDICTIONS_DATA if pred["status"] == "active"])}
                </div>

                <!-- Bottom Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="container">
                <p>&copy; 2025 SureBet Pro. All rights reserved. | Bet responsibly.</p>
            </div>
        </div>

        <script>
            (adsbygoogle = window.adsbygoogle || []).push({{}});
            (adsbygoogle = window.adsbygoogle || []).push({{}});
        </script>
    </body>
    </html>
    """)

@app.route("/statistics")
def statistics():
    # Track statistics page visit
    track_visitor('Statistics')
    
    return render_template_string(f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Statistics - SureBet Pro</title>
        
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6332657251575161"
            crossorigin="anonymous"></script>
        
        {BASE_STYLES}
    </head>
    <body>
        {NAVIGATION_TEMPLATE}
        
        <div class="container">
            <div class="main-content">
                <div class="hero-section">
                    <h1 class="hero-title">📊 Performance Statistics</h1>
                    <p class="hero-subtitle">Track our prediction accuracy and success rates</p>
                </div>

                <!-- Top Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>

                <div class="stats-container">
                    <div class="stat-card">
                        <span class="stat-number">87%</span>
                        <div class="stat-label">Overall Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">156</span>
                        <div class="stat-label">Successful Predictions</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">2.4</span>
                        <div class="stat-label">Average Odds</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">30</span>
                        <div class="stat-label">Days Tracking</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Monthly Performance</h3>
                    <p>Our prediction accuracy has been consistently above 85% for the past 3 months, with our highest success rate being 92% in May 2025.</p>
                </div>

                <!-- Bottom Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="container">
                <p>&copy; 2025 SureBet Pro. All rights reserved. | Bet responsibly.</p>
            </div>
        </div>

        <script>
            (adsbygoogle = window.adsbygoogle || []).push({{}});
            (adsbygoogle = window.adsbygoogle || []).push({{}});
        </script>
    </body>
    </html>
    """)

@app.route("/about")
def about():
    # Track about page visit
    track_visitor('About')
    
    return render_template_string(f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>About Us - SureBet Pro</title>
        
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6332657251575161"
            crossorigin="anonymous"></script>
        
        {BASE_STYLES}
    </head>
    <body>
        {NAVIGATION_TEMPLATE}
        
        <div class="container">
            <div class="main-content">
                <div class="hero-section">
                    <h1 class="hero-title">ℹ️ About SureBet Pro</h1>
                    <p class="hero-subtitle">Your trusted partner in professional betting predictions</p>
                </div>

                <!-- Top Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>

                <div class="card">
                    <h3>Our Mission</h3>
                    <p>At SureBet Pro, we combine advanced statistical analysis with expert football knowledge to provide you with the most accurate betting predictions. Our team of experienced analysts works around the clock to ensure you get the best possible insights for your betting decisions.</p>
                </div>

                <div class="card">
                    <h3>How We Work</h3>
                    <p>Our predictions are based on comprehensive data analysis including team form, head-to-head records, player statistics, weather conditions, and many other factors. We use machine learning algorithms to identify patterns and trends that give us an edge in prediction accuracy.</p>
                </div>

                <div class="card">
                    <h3>Responsible Gambling</h3>
                    <p>We promote responsible gambling and encourage our users to bet within their means. Gambling should be fun and entertaining, never a way to solve financial problems. Please gamble responsibly and seek help if you feel you have a gambling problem.</p>
                </div>

                <!-- Bottom Ad -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-6332657251575161"
                        data-ad-slot="1509818329"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="container">
                <p>&copy; 2025 SureBet Pro. All rights reserved. | Bet responsibly.</p>
            </div>
        </div>

        <script>
            (adsbygoogle = window.adsbygoogle || []).push({{}});
            (adsbygoogle = window.adsbygoogle || []).push({{}});
        </script>
    </body>
    </html>
    """)

@app.route("/api/visitors")
def api_visitors():
    """API endpoint to get visitor statistics as JSON"""
    return jsonify({
        "status": "success",
        "data": {
            "total_visits": VISITOR_DATA['total_visits'],
            "unique_visitors": len(VISITOR_DATA['unique_visitors']),
            "page_views": dict(VISITOR_DATA['page_views']),
            "daily_stats": dict(VISITOR_DATA['daily_stats']),
            "recent_visits": VISITOR_DATA['visit_log'][-10:][::-1]
        },
        "last_updated": datetime.now().isoformat()
    })

@app.route("/api/predictions")
def api_predictions():
    """API endpoint to get predictions as JSON"""
    return jsonify({
        "status": "success",
        "data": [pred for pred in PREDICTIONS_DATA if pred["status"] == "active"],
        "last_updated": datetime.now().isoformat()
    })

@app.route("/api/statistics")
def api_statistics():
    """API endpoint to get statistics as JSON"""
    return jsonify({
        "status": "success",
        "data": {
            "overall_accuracy": 87,
            "successful_predictions": 156,
            "average_odds": 2.4,
            "tracking_days": 30,
            "monthly_performance": {
                "may_2025": 92,
                "april_2025": 89,
                "march_2025": 85
            }
        },
        "last_updated": datetime.now().isoformat()
    })

if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=5000)
